\documentclass[xcolor={usenames,dvipsnames,svgnames,table}]{beamer}

%Load the myriad packages
\usepackage[orientation=landscape,size=a0,scale=1.4]{beamerposter}

% load macros and prevent authblk from loading
\input{../common/macros.tex}
\dontusepackage{authblk}

% load packages, settings and definitions
\input{../common/packages.tex}
\usepackage{exscale} 		% needs to stay at the end of package loading to fix integral signs
\input{../common/settings.tex}
\input{../common/definitions.tex}

\newcommand{\vr}{\vec{r}}
\newcommand{\vOmega}{\vec{\Omega}}
\newcommand{\vJ}{\vec{J}}
\newcommand{\vO}{\vec{\Omega}}
\newcommand{\bra}{\left\langle}
\newcommand{\ket}{\right\rangle}
\newcommand{\sbra}{\left[}
\newcommand{\sket}{\right]}
\newcommand{\vbeta}{\vec{\beta} }
\newcommand{\pdx}{\frac{\partial}{\partial x}}
\newcommand{\pdy}{\frac{\partial}{\partial y}}
\newcommand{\pdz}{\frac{\partial}{\partial z}}
\newcommand{\intrrr}{\int d^3 r \,}
\newcommand{\intrr}{\int d^2 r \,}
\newcommand{\dEdphi}{\partial_\phi E }
\newcommand{\dEdp}{\partial_p E }
\newcommand{\dBdphi}{\partial_\phi B }
\newcommand{\dBdp}{B }
\newcommand{\surf}{\int_{\partial V}}
\newcommand{\bound}{\partial V}
\newcommand{\vn}{\vec{n}}
\newcommand{\Edd}{\mathbb{E}}
\newcommand{\BEdd}{B}
\newcommand{\isigt}{c}
% why \newcommand{\angSource}{q_\Omega}
\newcommand{\angSource}{q}
\newcommand{\scalSource}{q}
\newcommand{\angResp}{q^\dag}
\newcommand{\scalResp}{q^\dag}
\newcommand{\qoi}{{\it QoI}\xspace}

\newcommand{\tcr}[1]{\textcolor{red}{#1}}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\mode<presentation>{\usetheme{TAMU}}

\title[<short>]{Adjoint-based sensitivity for radiation transport using an Eddington tensor formulation}
\author[<short>]{Ian Halvic, Jean Ragusa}
\institute{Department of Nuclear Engineering, Texas A\&M University, College Station, TX, USA 77843}

\newlength{\columnheight}
\setlength{\columnheight}{70cm}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{document}
\begin{frame}
	\begin{columns}

	%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
	\begin{column}{.33\textwidth}
		\begin{beamercolorbox}[center,wd=\textwidth]{postercolumn}
			\begin{minipage}[T]{0.95\textwidth} % tweaks the width, makes a new \textwidth
			\parbox[t][\columnheight]{\textwidth}{ % must be some better way to set the the height, width and textwidth simultaneously
			    % Since all columns are the same length, it is all nice and tidy.  You have to get the height empirically

			    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
			    \begin{block}{Motivation}
					Predictive scientific computing requires Quantities of Interest (QoI) and sensitivities to uncertain parameters ($\delta$QoI) 
					\begin{itemize}
					\item \tcr{QoI}$=\langle r, \psi \rangle$ (inner product over whole phase-space);\\ $r=$response function; $\psi$ is the forward angular flux, obtained from solving the neutron transport equation $L \psi = H\psi +q$.
					\item \tcr{$\delta$QoI}$=\langle r, \psi^{\text{pert}}-\psi \rangle$, with $\psi^{\text{pert}}$ the {\bf perturbed} angular flux due to a perturbation in $L$ (e.g., $\sigma_t$), in $H$ (e.g., $\sigma_s$), $q$, or boundary conditions.
					\item \tcr{Issue}: solving the transport equation is cost-prohibitive.
					\end{itemize}
					\vspace{1cm}
{\bf Proposed approach:}
\begin{itemize}
  \item Use \tcr{first-order-accurate adjoint-based formulation} (Sn adjoint transport).\\
	Only requires \tcr{2} full transport solve (one forward, one adjoint) to obtain QoI and $\delta$QoI.
	\item This is still cost-prohibitive for time-dependent transport problems: forward and adjoint solutions in space, energy, and angle must be stored at multiple time moments for subsequent retrieval.
	\item \tcr{This study}: to circumvent the storage issues by employing a Variable Eddington Tensor (\tcr{VET}) approach, which only requires storing scalar fluxes.
	\item \tcr{Analysis carried out}: Whether VET is a reasonable substitute for Sn adjoint transport.
\end{itemize}

			    \end{block}
			    \vfill


			    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
			    \begin{block}{First-order Sensitivity using Sn Transport}
Sn adjoint solve for {\bf nominal} (i.e., unperturbed) parameter values 			    
\begin{equation}
\label{snAdj}
%\begin{split}
%&- \vO_d \cdot \grad \psi^\dag_d + \sigt \psi^\dag_d = \frac{\sigs}{4 \pi} \phi^\dag + \angResp_d \\
%&\psi^\dag(\vr) = \psi^{\dag \text{out}}(\vr)=0 \quad \vr \in \partial V^{+} = \{  \vr \in \bound , \quad \vO \cdot \vec{n} > 0 \}
%\end{split}
L^\dag \psi^\dag = H^\dag \psi^\dag + \tcr{r}
\end{equation}
First-order perturbation sensitivity to be calculated as follows:
\begin{equation}
\label{snSens}
\delta QoI = \bra \delta \scalSource - \delta \sigt \psi + \frac{\delta\sigs}{4 \pi} \phi , \psi^\dag  \ket - \sbra \delta \psi^{\text{inc}}, \psi^\dag \sket_- \,
\end{equation}
\tcr{Only} requires unperturbed forward and adjoint angular fluxes.
			    \end{block}
			    \vfill
			    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%




			    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{block}{Eddington Formulation}
In an effort to remove the angular dependence of the system completely, an Eddington Tensor $\Edd$ is introduced:
%, along with a Boundary Eddington Factor $\BEdd$. These two values are the primary tools of the VET formulation.
\begin{equation}
\label{EddDef}
\Edd(\vr)=\frac{\int d\Omega \vO \vO \psi(\vr,\vO)}{\phi(\vr)}
\end{equation}
%\begin{equation}
%\BEdd(\vr) = \frac{\int_{4 \pi} d\Omega \, | \vO \cdot \vn | \psi}{\int_{4\pi} d\Omega \, \psi} \quad , \vr \in \bound 
%\end{equation}
With the \tcr{nominal} (i.e., unperturbed) Eddington values in hand, the Sn transport equation can be converted to the form shown below. 
\begin{equation}
\label{VEFForm}
%\begin{split}
- \div \left( \frac{1}{\sigt}\div \Edd \phi \right) + \siga \phi = \scalSource \quad + \text{B.C.} %\\
%&2 J^{\text{inc}}(\vr) = \BEdd(\vr) \phi(\vr) + \vn \cdot \frac{1}{\sigt} \div \Edd \phi  \quad , \vr \in \bound \,\
%\end{split}
\end{equation}

\end{block}
\vfill

			    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
			}
			\end{minipage}
		\end{beamercolorbox}
	\end{column}

	%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
	%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
	\begin{column}{.33\textwidth}
		\begin{beamercolorbox}[center,wd=\textwidth]{postercolumn}
			\begin{minipage}[T]{0.95\textwidth} % tweaks the width, makes a new \textwidth
			\parbox[t][\columnheight]{\textwidth}{ % must be some better way to set the the height, width and textwidth simultaneously
			         % Since all columns are the same length, it is all nice and tidy.  You have to get the height empirically


			    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
			    \begin{block}{VET Sensitivity}
Since VET formulation generates a new forward equation to describe the system, a new adjoint corresponding to Eq.~\eqref{VEFForm} can be obtained. 
\begin{equation}
\label{adjForm}
%\begin{split}
%&
- \Edd : \left( \grad \left( \frac{1}{\sigt}\grad \varphi^\dag \right) \right) + \siga \varphi^\dag = \scalResp %\\
%&2J^{\dag,\text{out}} = B \phi^\dag + 
%\Edd \cdot \frac{1}{\sigma_{t} } \vec{\nabla} \phi^\dag   \quad \vr \in \bound
%\end{split}
\end{equation}
The adjoint flux in this formulation is denoted by $\varphi^\dag$.\\
{\bf Note}:  This adjoint scalar flux is not the adjoint one would obtain from the Sn adjoint equation (the latter is denoted by $\phi^\dag$).
\vspace{1cm}
If the assumption is made that the Eddington factor remains unchanged under perturbation of the parameters, then a sensitivity inner product can be derived.


\begin{equation}
\label{SensIP1}
\begin{split}
\delta \qoi =&  \bra \delta q , \varphi^\dag \ket - \bra \delta \isigt \div (\Edd \phi), \grad \varphi^\dag \ket + \bra \delta \sigma_a \phi, \varphi^\dag \ket + \sbra \varphi^\dag, 2 \delta J^{\text{inc}} \sket \\
\end{split}
\end{equation}

The Sn-adjoint method is exact for perturbations in $q$ and $\psi^\text{inc}$ and does not require storing $\psi$ through the volume. This leads to a ``blended'' sensitivity expression which also uses Sn-adjoint solution $\phi^\dag$

\begin{equation}
\label{SensIP2}
\begin{split}
\delta \qoi =&  \bra \delta q , \phi^\dag \ket - \bra \delta \isigt \div (\Edd \phi), \grad \varphi^\dag \ket + \bra \delta \sigma_a \phi, \varphi^\dag \ket \\
\end{split} - \sbra \delta \psi^{\text{inc}}, \psi^\dag \sket_- \,
\end{equation}


			    \end{block}
			    \vfill
			    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
			    \begin{block}{Eddington estimation}
			    For problems where many perturbation scenarios must be computed, an attempt can be made to predict the Eddington perturbation $\delta \Edd$, at the cost of additional Sn solves. 
\begin{equation}
	\delta \Edd \approx \frac{\partial \Edd}{\partial p} \delta p \approx \frac{\Edd(p_1) - \Edd(p_0)}{p_1 - p_0} \delta p	     
\end{equation}

A simple linear approximation scheme is considered. The method requires one additional forward Sn solve per perturbed variable $p$ to obtain $E(p_1)$.	
The approximation was applied to a test system in which a homogeneous system is regularly perturbed to an inhomogeneous one.

\begin{figure}[H]
\label{Case110syst}
\centering
\begin{subfigure}{.33\textwidth}
  \centering
  \includegraphics[width=.98\linewidth]{110phi.png}
  \caption{$\phi$ unperturbed and perturbed due to $+15\%$ $\siga$.}
  \label{fig:sfig1}
\end{subfigure}
\begin{subfigure}{.33\textwidth}
  \centering
  \includegraphics[width=.98\linewidth]{110phia.png}
    \caption{Both Sn and VET adjoints, $\phi^\dag$ and $\varphi^\dag$ respectively.}
  \label{fig:sfig2}
\end{subfigure}%
\begin{subfigure}{.33\textwidth}
  \centering
  \includegraphics[width=.98\linewidth]{110deltaE.png}
    \caption{Estimation of $\delta \Edd$. Extrapolation point used was $+10\%$ $\siga$.}
  \label{fig:sfig5}
\end{subfigure}%
\label{fig:fig}
\end{figure}		     
		    	\vfill
			    \end{block}
			    \vfill
			    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
			}
			\end{minipage}
		\end{beamercolorbox}
	\end{column}

	%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
	%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
	\begin{column}{.33\textwidth}
		\begin{beamercolorbox}[center,wd=\textwidth]{postercolumn}
			\begin{minipage}[T]{0.95\textwidth} % tweaks the width, makes a new \textwidth
			\parbox[t][\columnheight]{\textwidth}{ % must be some better way to set the the height, width and textwidth simultaneously
			         % Since all columns are the same length, it is all nice and tidy.  You have to get the height empirically

			    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
			    \begin{block}{Eddington estimation continued}

The full sensitivity expression using the estimated $\delta \Edd$ is then

\begin{equation}
\label{SensIP3}
\begin{split}
\delta \qoi =&  \bra \delta q , \varphi^\dag \ket - \bra \delta \isigt \div (\Edd \phi), \grad \varphi^\dag \ket + \bra \delta \sigma_a \phi, \varphi^\dag \ket + \sbra \varphi^\dag, 2 \delta J^{\text{inc}} \sket \\
& - \bra  \isigt \div \left( \delta \Edd \phi \right), \grad \varphi^\dag \ket
- \sbra \varphi^\dag, \phi \delta \BEdd \sket.
\end{split}
\end{equation}			    
			    
Sensitivity for the earlier presented system due to regular perturbations in the source, $\sigs$, and $\siga$. The Sensitivity inner products laid out in Eqs.~\eqref{SensIP1}, ~\eqref{SensIP2}, ~\eqref{SensIP3} are tested against two individual forward solves.
 
\begin{figure}[H]
\label{Case110Sens}
\centering
\begin{subfigure}{.4\textwidth}
  \centering
  \includegraphics[width=.98\linewidth]{110qSens.png}  \caption{Source sensitivity}
  \label{fig:sfig1}
\end{subfigure}%
\begin{subfigure}{.4\textwidth}
  \centering
  \includegraphics[width=.98\linewidth]{110sigsSens.png}
  \caption{Scattering cross-section sensitivity}
  \label{fig:sfig2}
\end{subfigure}

\begin{subfigure}{.4\textwidth}
  \centering
  \includegraphics[width=.98\linewidth]{110sigaSens.png}
  \caption{Absorption cross-section sensitivity}
  \label{fig:sfig5}
\end{subfigure}%
\begin{subfigure}{.4\textwidth}
  \centering
  \includegraphics[width=.98\linewidth]{110incSens.png}
  \caption{Incident flux sensitivity}
  \label{fig:sfig4}
\end{subfigure}
\label{fig:fig}
\end{figure}			    
			    
			    
			    \end{block}
			    \vfill
			    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
			    \begin{block}{Conclusion}

$\bullet$ The Eddington formulation of the transport equation yields an adjoint that is not directly related to the Sn transport adjoint.
			    

$\bullet$ This VET adjoint can be used to compute response sensitivity without storing angular flux if assumptions are made about perturbation of the Eddington


$\bullet$ At the additional cost of solving and storing the Sn adjoint scalar flux, exact sensitivity of source perturbations can be obtained, while using VET adjoint for cross-section perturbations

$\bullet$ In situations where numerous perturbation cases must be considered, sampling Eddington values using additional forward solves can increase the VET adjoint accuracy when compared to Sn adjoint. 
			    \end{block}
			    \vfill
			}
			\end{minipage}
		\end{beamercolorbox}
	\end{column}

	\end{columns}
\end{frame}
\end{document}

